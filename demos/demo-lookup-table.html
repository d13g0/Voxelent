<html>
<head>
<meta name='Diego Cantor' content='Voxelent: The best WebGL platform yet'>
<meta name='copyright' content='&copy; 2011'>
<meta name='robots' content='all'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name='keywords' content='webgl, webgl platform, medical imaging, webgl api'>

<title>Voxelent - Cube Lookup Table Demo</title>

<script src="lib/jquery.js" type="text/javascript"></script>
<script type='text/javascript' src='lib/voxelent_v0.87.6.js'></script>

<script type='text/javascript'>

var view;
var S = 3;
var T = (Math.pow(S*2+1,3) - Math.pow(S*2-1,3)); //external cube minus internal cube. Easy!

function runVoxApp(){
    vxl.api.subscribe(vxl.events.MODELS_LOADED, this);
    vxl.api.loadLUTS('assets/tables');
    
    view = vxl.api.setup('view-1');
    vxl.api.load('assets/models/geometry/cube.json');
    
    view.start();
};

function handleEvent(event){

    var cube = vxl.api.getActorByName('cube.json');
    view.scene.removeActor(cube);
    
    var lut = vxl.go.lookupTableManager.get('default');
    
    var count = 0, clonedCube = undefined;
    
    for (var i=-S;i<=S;i+=1){
    	for (var j=-S;j<=S;j+=1){
    		for (var k=-S;k<=S;k+=1){
    			if (Math.abs(i) <S && Math.abs(j) <S  && Math.abs(k) < S) {
    				continue;  //don't bother with internal cubes that are not rendered
    			}
    			count++;
    			clonedCube = cube.clone();
    			clonedCube.setPosition(i*1.5,j*1.5,k*1.5);
    			clonedCube.setColor(lut.getColor(count,0,T));
    			clonedCube.setShading(false);
    			view.scene.addActor(clonedCube);
    		}
    	}
    }
 

    var cam = vxl.c.camera;
    cam.setPosition(0,0,40);
    cam.setAzimuth(-45);   
    cam.setElevation(-45); 

    
    var tables = vxl.api.getLookupTables();
	var options = "";
	for (var i=0;i<tables.length;i+=1){
		options += '<option value=\"'+tables[i]+'\">'+tables[i]+'</option>';
	}
	$('#lutPicker').html(options);
	
    $('#lutPicker').change(function(){
    	setLookupTable($('#lutPicker').val());
    });    
};

function setLookupTable(ID){
	var lut = vxl.go.lookupTableManager.get(ID);
	for(var i=0; i<view.scene.actors.length; i+=1){
		var actor = view.scene.actors[i];
		actor.setColor(lut.getColor(i,0,T));
	}
};
</script>

<script type="text/javascript">
  //Google Analytics Script 
  var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-26954785-1']); _gaq.push(['_trackPageview']);  (function() {  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);   })();
</script>

<style type="text/css">
.show {

     position: relative;
}

.overlay {
    width: 150px;
    height: 20%;
    position: absolute;
    top: 0px;
    right: 0px;
    font-size:12px;
	font-family: Arial,Helvetica;
}

.overlay select{
   background: #333;
   color: #BCBCBC;
   width: 100px;
   padding: 5px;
   font-size: 14px;
   height: 30px;
   border: 0px;
}
</style> 
</head>
<body onload='runVoxApp()'>
	<div><img src="css/img/voxelent.png" /></div>
	<div class='show'>
	<canvas id = 'view-1' width=800 height=650 >
		<p>
			Your browser does not support WebGL :-(
		</p>
	</canvas>
    
    
    <div class='overlay'>
      <p>Please select one lookup table</p>
      <select id='lutPicker'></select>
    </div>  
    
    </div>
</body>			
</html>
