<html>
<head>
<meta name='Diego Cantor' content='Voxelent: The best WebGL platform yet'>
<meta name='copyright' content='&copy 2011'>
<meta name='robots' content='all'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name='keywords' content='webgl, webgl platform, medical imaging, webgl api'>

<title>Voxelent - Cell Picking Test</title>

<link rel='stylesheet' type='text/css' href='css/jquery-ui-bs/theme.css'/>

<script src="lib/jquery.js" type="text/javascript"> </script>
<script src="lib/jquery-ui.js" type="text/javascript"> </script>
<script type='text/javascript' src='lib/voxelent_v0.89.1.js'> </script>

<script type='text/javascript'>

var view, actor, mesh , pickerInteractor, currentInteractor;


function runVoxApp(){
    vxl.api.subscribe(vxl.events.MODELS_LOADED, this);
    view = vxl.api.setup('view-1');
    vxl.api.load('ball.json','assets/models/geometry');
    view.start();
    view.renderer.enableOffscreen();
    pickerInteractor = new vxlPickerInteractor();
    defaultInteractor = view.interactor;
};

function handleEvent(event){
     
    actor = vxl.api.getActor('ball');
    actor.setColor(0,0.3,0.8);
    actor.setPosition(0,0,-10);
    actor.setVisualizationMode(vxl.def.actor.mode.FLAT);
    actor.setPicker(vxl.def.actor.picking.CELL, pickingCallback);
    
    var cam = vxl.c.camera;
    cam.setType(vxl.def.camera.type.ORBITING);
    cam.longShot();
    vxl.api.floorON(60,5);
};


function pickingCallback(actor, uid){
    
    console.info(uid);
    //var cell = actor.mesh.getCell(cellid);
    actor.mesh.removeCell(uid);
    actor.mesh.renderable  = actor.mesh._getRenderable();
};

document.onkeypress = function(e){
    e = e || window.event;
    var charCode = (typeof e.which == "number") ? e.which : e.keyCode;
    
    if (charCode == 112) {
        if ( view.interactor.UID == pickerInteractor.UID){
            view.setInteractor(defaultInteractor);
            console.info('default interactor active');
        }
        else{
            view.setInteractor(pickerInteractor);
            console.info('picker interactor active');
        }    
    }
};


</script>

<script type="text/javascript">
  //Google Analytics Script 
// var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-26954785-1']); _gaq.push(['_trackPageview']);  (function() {  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);   })();
</script>

</head>
<body onload='runVoxApp()'>
	<div><img src="css/img/voxelent.png" /></div>
	<div>
	<canvas id = 'view-1' width='1200' height='600'>
		<p>
			Your browser does not support WebGL :-(
		</p>
	</canvas>
    </div>
</body>			
</html>
