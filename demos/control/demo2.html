<html>
<head>
<meta name='Diego Cantor' content='Voxelent: The best WebGL platform yet'>
<meta name='copyright' content='&copy 2011'>
<meta name='robots' content='all'>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name='keywords' content='webgl, webgl platform, medical imaging, webgl api'>

<title>Voxelent - Following an actor</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type='text/javascript' src='voxelent_v0.89.js'> </script>

<script type='text/javascript'>

var view;
var cone;

function runVoxApp(){
    vxl.api.subscribe(vxl.events.MODELS_LOADED, this);
    view = vxl.api.setup('view-1');
    vxl.api.load('cone.json','');
    view.start();
}

function handleEvent(event){

    cone    = vxl.api.getActor('cone'); //new method introduced in 0.88.1
    cone.setPosition(0,5,0);
    var cam = vxl.c.camera;
    //cam.setType(vxl.def.camera.type.TRACKING);
    cam.setPosition(0,3,30);
    //cam.longShot();
    //cam.follow(cone, vxl.def.camera.tracking.ROTATIONAL);
    vxl.api.floorON(50,5);
    startAnimation();
   
}

function loadData(filename){

var successHandler = function(){
	return function(json, textStatus){
	        if (json == null) return;
            var d = json.data;
            if (d == undefined) return;
            
            var m = mat4.identity();
            mat4.translate(m, cone._position);
            mat4.set(m, cone._matrix);
            cone.rotateY(d[0]);
            cone.rotateZ(d[1]);
            cone.rotateX(d[2]);
            view.refresh();
	}
};
	
var errorHandler = function(filename){
	return function(request, status, error){
	}
};

var request  = $.ajax({
	url			:filename,
	type		:"GET",
	dataType	:"json",
	success 	: successHandler(),
	error		: errorHandler(filename)
});   

};


function onFrame(){
   loadData('data.json');
}
 
function startAnimation(){
    setInterval(onFrame,50);
}
</script>


</head>
<body onload='runVoxApp()'>
	
	<div>
	<canvas id = 'view-1' width='1200' height='600'>
		<p>
			Your browser does not support WebGL :-(
		</p>
	</canvas>
    </div>
</body>			
</html>

