vxl.vec3={};vxl.vec3.dot=function(d,c){if(!(d instanceof vxlVector3)||!(c instanceof vxlVector3)){alert("vxl.math.vector.dot ERROR");return null}return((d.x*c.x)+(d.y*c.y)+(d.z*c.z))};vxl.vec3.cross=function(d,c){if(!(d instanceof vxlVector3)||!(c instanceof vxlVector3)){alert("vxl.math.vector.cross ERROR");return null}var g=d.y*c.z-d.z*c.y;var f=d.z*c.x-d.x*c.z;var e=d.x*c.y-d.y*c.x;return new vxlVector3(g,f,e)};vxl.vec3.subtract=function(d,c){if(!(d instanceof vxlVector3)||!(c instanceof vxlVector3)){alert("vxl.math.vector.substract ERROR");
return null}return new vxlVector3(d.x-c.x,d.y-c.y,d.z-c.z)};vxl.vec3.scale=function(a,b){if(!(a instanceof vxlVector3)){alert("vxl.math.vector.scale ERROR");return null}var c=new vxlVector3();c.x=a.x*b;c.y=a.y*b;c.z=a.z*b;return c};vxl.vec3.negate=function(a){return vxl.vec3.scale(a,-1)};vxl.vec3.length=function(a){return Math.sqrt((a.x*a.x)+(a.y*a.y)+(a.z*a.z))};vxl.vec3.round=function(a,b){var a=this;if(b==null||b==undefined||b<0){a.x=Math.round(a.x);a.y=Math.round(a.y);a.z=Math.round(a.z)}a.x=Math.round(a.x*10*b)/(10*b);
a.y=Math.round(a.y*10*b)/(10*b);a.z=Math.round(a.z*10*b)/(10*b)};vxl.vec3.normalize=function(a){var b=vxl.vec3.length(a);if(b==0){message("ERROR: normalizing a vector by a zero norm")}a.x=a.x/b;a.y=a.y/b;a.z=a.z/b};vxl.vec3.set=function(d,c){if(d instanceof Array){c.x=d[0];c.y=d[1];c.z=d[2]}else{if(d instanceof vxlVector3){c.x=d.x;c.y=d.y;c.z=d.z}else{c.x=0;c.y=0;c.z=0}}};function vxlVector3(a,c,b){this.x=0;this.y=0;this.z=0;if(a!=null){this.x=a}if(c!=null){this.y=c}if(b!=null){this.z=b}}vxlVector3.prototype.toString=function(c,d){var a=this;
var b="vector ";if(isNaN(a.x)||isNaN(a.y)||isNaN(a.z)){return"vector "+d+" does not have numeric values"}if(d!=null){b=d}if(c==null){return b+": ("+a.x+","+a.y+","+a.z+")"}else{if(c>0){return b+":("+a.x.toFixed(c)+","+a.y.toFixed(c)+","+a.z.toFixed(c)+")"}}};vxl.vec3.create=function(a){return new vxlVector3(a[0],a[1],a[2])};function vxlVector4(a,d,c,b){this.x=0;this.y=0;this.z=0;this.h=1;if(a!=null){this.x=a}if(d!=null){this.y=d}if(c!=null){this.z=c}if(b!=null){this.h=b}}vxlVector4.prototype.toString=function(c,d){var a=this;
var b="vector ";if(isNaN(a.x)||isNaN(a.y)||isNaN(a.z)){return"vector "+d+" does not have numeric values"}if(d!=null){b=d}if(c==null){return b+": ("+a.x+","+a.y+","+a.z+","+a.h+")"}else{if(c>0){return b+":("+a.x.toFixed(c)+","+a.y.toFixed(c)+","+a.z.toFixed(c)+","+a.h.toFixed(c)+")"}}};vxl.vec4={};vxl.vec4.create=function(a){return new vxlVector4(a[0],a[1],a[2],a[3])};vxl.mat4={};vxl.mat4.set=function(a,b){if(arguments.length==2){if("length" in a&&a.length==16){b.m11=a[0];b.m12=a[1];b.m13=a[2];b.m14=a[3];
b.m21=a[4];b.m22=a[5];b.m23=a[6];b.m24=a[7];b.m31=a[8];b.m32=a[9];b.m33=a[10];b.m34=a[11];b.m41=a[12];b.m42=a[13];b.m43=a[14];b.m44=a[15];return}else{if(a instanceof vxlMatrix4x4){b.m11=a.m11;b.m12=a.m12;b.m13=a.m13;b.m14=a.m14;b.m21=a.m21;b.m22=a.m22;b.m23=a.m23;b.m24=a.m24;b.m31=a.m31;b.m32=a.m32;b.m33=a.m33;b.m34=a.m34;b.m41=a.m41;b.m42=a.m42;b.m43=a.m43;b.m44=a.m44;return}}}};vxl.mat4.identity=function(a){a.m11=1;a.m12=0;a.m13=0;a.m14=0;a.m21=0;a.m22=1;a.m23=0;a.m24=0;a.m31=0;a.m32=0;a.m33=1;
a.m34=0;a.m41=0;a.m42=0;a.m43=0;a.m44=1};vxl.mat4.transpose=function(a){var b=a.m12;a.m12=a.m21;a.m21=b;b=a.m13;a.m13=a.m31;a.m31=b;b=a.m14;a.m14=a.m41;a.m41=b;b=a.m23;a.m23=a.m32;a.m32=b;b=a.m24;a.m24=a.m42;a.m42=b;b=a.m34;a.m34=a.m43;a.m43=b};vxl.mat4.inverse=function(a,b){var c=vxl.mat4._determinant4x4(a);if(Math.abs(c)<1e-8){return null}vxl.mat4._makeAdjoint(a);a.m11/=c;a.m12/=c;a.m13/=c;a.m14/=c;a.m21/=c;a.m22/=c;a.m23/=c;a.m24/=c;a.m31/=c;a.m32/=c;a.m33/=c;a.m34/=c;a.m41/=c;a.m42/=c;a.m43/=c;
a.m44/=c};vxl.mat4.multVec3=function(a,c){var d=new vxlVector3();var b=new vxlVector3();if(c instanceof Array){b=vxl.vec3.create(c)}else{if(c instanceof vxlVector3){b=c}else{alert("error")}}d.x=a.m11*b.x+a.m12*b.y+a.m13*b.z;d.y=a.m21*b.x+a.m22*b.y+a.m23*b.z;d.z=a.m31*b.x+a.m32*b.y+a.m33*b.z;return d};vxl.mat4.multVec4=function(a,c){var d=new vxlVector4();var b=new vxlVector4();if(c instanceof Array){b=vxl.vec4.create(c)}else{if(c instanceof vxlVector4){b=c}else{alert("error")}}d.x=a.m11*b.x+a.m12*b.y+a.m13*b.z+a.m14*b.h;
d.y=a.m21*b.x+a.m22*b.y+a.m23*b.z+a.m24*b.h;d.z=a.m31*b.x+a.m32*b.y+a.m33*b.z+a.m34*b.h;d.h=a.m41*b.x+a.m42*b.y+a.m43*b.z+a.m44*b.h;return d};vxl.mat4.translate=function(a,b){a.m41=a.m11*b.x+a.m21*b.y+a.m31*b.z+a.m41;a.m42=a.m12*b.x+a.m22*b.y+a.m32*b.z+a.m42;a.m43=a.m13*b.x+a.m23*b.y+a.m33*b.z+a.m43;a.m44=a.m14*b.x+a.m24*b.y+a.m34*b.z+a.m44;return a};vxl.mat4.scale=function(a,c){if(c.x==undefined){c.x=1}if(c.z==undefined){if(c.y==undefined){c.y=c.x;c.z=c.x}else{c.z=1}}else{if(c.y==undefined){c.y=c.x
}}var b=new vxlMatrix4x4();b.m11=c.x;b.m22=c.y;b.m33=c.z;vxl.mat4.multRight(a,b)};vxl.mat4.rotate=function(c,d,j){d=d/180*Math.PI;d/=2;var h=Math.sin(d);var f=Math.cos(d);var i=h*h;var b=Math.sqrt(j.x*j.x+j.y*j.y+j.z*j.z);if(b==0){j.x=0;j.y=0;j.z=1}else{if(b!=1){j.x/=b;j.y/=b;j.z/=b}}var k=new vxlMatrix4x4();if(j.x==1&&j.y==0&&j.z==0){k.m11=1;k.m12=0;k.m13=0;k.m21=0;k.m22=1-2*i;k.m23=2*h*f;k.m31=0;k.m32=-2*h*f;k.m33=1-2*i;k.m14=k.m24=k.m34=0;k.m41=k.m42=k.m43=0;k.m44=1}else{if(j.x==0&&j.y==1&&j.z==0){k.m11=1-2*i;
k.m12=0;k.m13=-2*h*f;k.m21=0;k.m22=1;k.m23=0;k.m31=2*h*f;k.m32=0;k.m33=1-2*i;k.m14=k.m24=k.m34=0;k.m41=k.m42=k.m43=0;k.m44=1}else{if(j.x==0&&j.y==0&&j.z==1){k.m11=1-2*i;k.m12=2*h*f;k.m13=0;k.m21=-2*h*f;k.m22=1-2*i;k.m23=0;k.m31=0;k.m32=0;k.m33=1;k.m14=k.m24=k.m34=0;k.m41=k.m42=k.m43=0;k.m44=1}else{var a=j.x*j.x;var g=j.y*j.y;var e=j.z*j.z;k.m11=1-2*(g+e)*i;k.m12=2*(j.x*j.y*i+j.z*h*f);k.m13=2*(j.x*j.z*i-j.y*h*f);k.m21=2*(j.y*j.x*i-j.z*h*f);k.m22=1-2*(e+a)*i;k.m23=2*(j.y*j.z*i+j.x*h*f);k.m31=2*(j.z*j.x*i+j.y*h*f);
k.m32=2*(j.z*j.y*i-j.x*h*f);k.m33=1-2*(a+g)*i;k.m14=k.m24=k.m34=0;k.m41=k.m42=k.m43=0;k.m44=1}}}vxl.mat4.multRight(c,k)};vxl.mat4.rotateX=function(k,a,i){var n=Math.sin(a);var g=Math.cos(a);var m=k.m21,l=k.m22,j=k.m23,h=k.m24;var f=k.m31,e=k.m32,d=k.m33,b=k.m34;if(!i){i=k}else{if(k!=i){i.m11=k.m11;i.m12=k.m12;i.m13=k.m13;i.m14=k.m14;i.m41=k.m41;i.m42=k.m42;i.m43=k.m43;i.m44=k.m44}}i.m21=m*g+f*n;i.m22=l*g+e*n;i.m23=j*g+d*n;i.m24=h*g+b*n;i.m31=m*-n+f*g;i.m32=l*-n+e*g;i.m33=j*-n+d*g;i.m34=h*-n+b*g;return i
};vxl.mat4.rotateY=function(m,e,l){var n=Math.sin(e);var k=Math.cos(e);var f=m.m11,d=m.m12,b=m.m13,a=m.m14;var j=m.m31,i=m.m32,h=m.m33,g=m.m34;if(!l){l=m}else{if(m!=l){l.m21=m.m21;l.m22=m.m22;l.m23=m.m23;l.m24=m.m24;l.m41=m.m41;l.m42=m.m42;l.m43=m.m43;l.m44=m.m44}}l.m11=f*k+j*-n;l.m12=d*k+i*-n;l.m13=b*k+h*-n;l.m14=a*k+g*-n;l.m31=f*n+j*k;l.m32=d*n+i*k;l.m33=b*n+h*k;l.m34=a*n+g*k;return l};vxl.mat4.multRight=function(i,j){var q=(i.m11*j.m11+i.m12*j.m21+i.m13*j.m31+i.m14*j.m41);var o=(i.m11*j.m12+i.m12*j.m22+i.m13*j.m32+i.m14*j.m42);
var n=(i.m11*j.m13+i.m12*j.m23+i.m13*j.m33+i.m14*j.m43);var k=(i.m11*j.m14+i.m12*j.m24+i.m13*j.m34+i.m14*j.m44);var d=(i.m21*j.m11+i.m22*j.m21+i.m23*j.m31+i.m24*j.m41);var c=(i.m21*j.m12+i.m22*j.m22+i.m23*j.m32+i.m24*j.m42);var b=(i.m21*j.m13+i.m22*j.m23+i.m23*j.m33+i.m24*j.m43);var a=(i.m21*j.m14+i.m22*j.m24+i.m23*j.m34+i.m24*j.m44);var h=(i.m31*j.m11+i.m32*j.m21+i.m33*j.m31+i.m34*j.m41);var g=(i.m31*j.m12+i.m32*j.m22+i.m33*j.m32+i.m34*j.m42);var f=(i.m31*j.m13+i.m32*j.m23+i.m33*j.m33+i.m34*j.m43);
var e=(i.m31*j.m14+i.m32*j.m24+i.m33*j.m34+i.m34*j.m44);var s=(i.m41*j.m11+i.m42*j.m21+i.m43*j.m31+i.m44*j.m41);var r=(i.m41*j.m12+i.m42*j.m22+i.m43*j.m32+i.m44*j.m42);var p=(i.m41*j.m13+i.m42*j.m23+i.m43*j.m33+i.m44*j.m43);var l=(i.m41*j.m14+i.m42*j.m24+i.m43*j.m34+i.m44*j.m44);i.m11=q;i.m12=o;i.m13=n;i.m14=k;i.m21=d;i.m22=c;i.m23=b;i.m24=a;i.m31=h;i.m32=g;i.m33=f;i.m34=e;i.m41=s;i.m42=r;i.m43=p;i.m44=l};vxl.mat4.multLeft=function(i,j){var q=(j.m11*i.m11+j.m12*i.m21+j.m13*i.m31+j.m14*i.m41);var o=(j.m11*i.m12+j.m12*i.m22+j.m13*i.m32+j.m14*i.m42);
var n=(j.m11*i.m13+j.m12*i.m23+j.m13*i.m33+j.m14*i.m43);var k=(j.m11*i.m14+j.m12*i.m24+j.m13*i.m34+j.m14*i.m44);var d=(j.m21*i.m11+j.m22*i.m21+j.m23*i.m31+j.m24*i.m41);var c=(j.m21*i.m12+j.m22*i.m22+j.m23*i.m32+j.m24*i.m42);var b=(j.m21*i.m13+j.m22*i.m23+j.m23*i.m33+j.m24*i.m43);var a=(j.m21*i.m14+j.m22*i.m24+j.m23*i.m34+j.m24*i.m44);var h=(j.m31*i.m11+j.m32*i.m21+j.m33*i.m31+j.m34*i.m41);var g=(j.m31*i.m12+j.m32*i.m22+j.m33*i.m32+j.m34*i.m42);var f=(j.m31*i.m13+j.m32*i.m23+j.m33*i.m33+j.m34*i.m43);
var e=(j.m31*i.m14+j.m32*i.m24+j.m33*i.m34+j.m34*i.m44);var s=(j.m41*i.m11+j.m42*i.m21+j.m43*i.m31+j.m44*i.m41);var r=(j.m41*i.m12+j.m42*i.m22+j.m43*i.m32+j.m44*i.m42);var p=(j.m41*i.m13+j.m42*i.m23+j.m43*i.m33+j.m44*i.m43);var l=(j.m41*i.m14+j.m42*i.m24+j.m43*i.m34+j.m44*i.m44);i.m11=q;i.m12=o;i.m13=n;i.m14=k;i.m21=d;i.m22=c;i.m23=b;i.m24=a;i.m31=h;i.m32=g;i.m33=f;i.m34=e;i.m41=s;i.m42=r;i.m43=p;i.m44=l};vxl.mat4.ortho=function(c,b,k,a,i,h,g){var f=(b+k)/(b-k);var e=(i+a)/(i-a);var d=(g+h)/(g-h);
var j=new vxlMatrix4x4();j.m11=2/(b-k);j.m12=0;j.m13=0;j.m14=0;j.m21=0;j.m22=2/(i-a);j.m23=0;j.m24=0;j.m31=0;j.m32=0;j.m33=-2/(g-h);j.m34=0;j.m41=f;j.m42=e;j.m43=d;j.m44=1;vxl.mat4.multRight(c,j)};vxl.mat4.frustum=function(g,f,l,b,j,i,h){var k=new vxlMatrix4x4();var e=(l+f)/(l-f);var d=(j+b)/(j-b);var c=-(h+i)/(h-i);var a=-(2*h*i)/(h-i);k.m11=(2*i)/(l-f);k.m12=0;k.m13=0;k.m14=0;k.m21=0;k.m22=2*i/(j-b);k.m23=0;k.m24=0;k.m31=e;k.m32=d;k.m33=c;k.m34=-1;k.m41=0;k.m42=0;k.m43=a;k.m44=0;vxl.mat4.multRight(g,k)
};vxl.mat4.perspective=function(e,c,a,f,g){var h=Math.tan(c*Math.PI/360)*f;var b=-h;var d=a*b;var i=a*h;vxl.mat4.frustum(e,d,i,b,h,f,g)};vxl.mat4.lookat=function(i,p,o,n,k,j,h,d,c,b){var l=new vxlMatrix4x4();var s=p-k;var r=o-j;var q=n-h;var a=Math.sqrt(s*s+r*r+q*q);if(a){s/=a;r/=a;q/=a}var g=d;var f=c;var e=b;xx=f*q-e*r;xy=-g*q+e*s;xz=g*r-f*s;g=r*xz-q*xy;f=-s*xz+q*xx;g=s*xy-r*xx;a=Math.sqrt(xx*xx+xy*xy+xz*xz);if(a){xx/=a;xy/=a;xz/=a}a=Math.sqrt(g*g+f*f+e*e);if(a){g/=a;f/=a;e/=a}l.m11=xx;l.m12=xy;
l.m13=xz;l.m14=0;l.m21=g;l.m22=f;l.m23=e;l.m24=0;l.m31=s;l.m32=r;l.m33=q;l.m34=0;l.m41=0;l.m42=0;l.m43=0;l.m44=1;l.translate(-p,-o,-n);vxl.mat4.multRight(i,l)};vxl.mat4._determinant2x2=function(f,e,h,g){return f*g-e*h};vxl.mat4._determinant3x3=function(c,b,a,i,h,g,f,e,d){return c*vxl.mat4._determinant2x2(h,g,e,d)-i*vxl.mat4._determinant2x2(b,a,e,d)+f*vxl.mat4._determinant2x2(b,a,h,g)};vxl.mat4._determinant4x4=function(f){var e=f.m11;var o=f.m12;var j=f.m13;var c=f.m14;var d=f.m21;var n=f.m22;var i=f.m23;
var b=f.m24;var a=f.m31;var l=f.m32;var h=f.m33;var r=f.m34;var q=f.m41;var k=f.m42;var g=f.m43;var p=f.m44;return e*vxl.mat4._determinant3x3(n,l,k,i,h,g,b,r,p)-o*vxl.mat4._determinant3x3(d,a,q,i,h,g,b,r,p)+j*vxl.mat4._determinant3x3(d,a,q,n,l,k,b,r,p)-c*vxl.mat4._determinant3x3(d,a,q,n,l,k,i,h,g)};vxl.mat4._makeAdjoint=function(f){var e=f.m11;var o=f.m12;var j=f.m13;var c=f.m14;var d=f.m21;var n=f.m22;var i=f.m23;var b=f.m24;var a=f.m31;var l=f.m32;var h=f.m33;var r=f.m34;var q=f.m41;var k=f.m42;
var g=f.m43;var p=f.m44;f.m11=vxl.mat4._determinant3x3(n,l,k,i,h,g,b,r,p);f.m21=-vxl.mat4._determinant3x3(d,a,q,i,h,g,b,r,p);f.m31=vxl.mat4._determinant3x3(d,a,q,n,l,k,b,r,p);f.m41=-vxl.mat4._determinant3x3(d,a,q,n,l,k,i,h,g);f.m12=-vxl.mat4._determinant3x3(o,l,k,j,h,g,c,r,p);f.m22=vxl.mat4._determinant3x3(e,a,q,j,h,g,c,r,p);f.m32=-vxl.mat4._determinant3x3(e,a,q,o,l,k,c,r,p);f.m42=vxl.mat4._determinant3x3(e,a,q,o,l,k,j,h,g);f.m13=vxl.mat4._determinant3x3(o,n,k,j,i,g,c,b,p);f.m23=-vxl.mat4._determinant3x3(e,d,q,j,i,g,c,b,p);
f.m33=vxl.mat4._determinant3x3(e,d,q,o,n,k,c,b,p);f.m43=-vxl.mat4._determinant3x3(e,d,q,o,n,k,j,i,g);f.m14=-vxl.mat4._determinant3x3(o,n,l,j,i,h,c,b,r);f.m24=vxl.mat4._determinant3x3(e,d,a,j,i,h,c,b,r);f.m34=-vxl.mat4._determinant3x3(e,d,a,o,n,l,c,b,r);f.m44=vxl.mat4._determinant3x3(e,d,a,o,n,l,j,i,h)};vxlMatrix4x4=function(a){this.m11=0;this.m12=0;this.m13=0;this.m14=0;this.m21=0;this.m22=0;this.m23=0;this.m24=0;this.m31=0;this.m32=0;this.m33=0;this.m34=0;this.m41=0;this.m42=0;this.m43=0;this.m44=0;
if(arguments.length==1&&a instanceof vxlMatrix){vxl.mat4.set(a,this)}};vxlMatrix4x4.prototype.getAsArray=function(){return[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.m41,this.m42,this.m43,this.m44]};vxlMatrix4x4.prototype.getAsFloat32Array=function(){return new Float32Array(this.getAsArray())};vxlMatrix4x4.prototype.toString=function(){return debugMatrix(this)};debugMatrix=function(a){return"Matrix\n"+a.m11.toFixed(2)+" "+a.m12.toFixed(2)+" "+a.m13.toFixed(2)+" "+a.m14.toFixed(2)+"\n"+a.m21.toFixed(2)+" "+a.m22.toFixed(2)+" "+a.m23.toFixed(2)+" "+a.m24.toFixed(2)+"\n"+a.m31.toFixed(2)+" "+a.m32.toFixed(2)+" "+a.m33.toFixed(2)+" "+a.m34.toFixed(2)+"\n"+a.m41.toFixed(2)+" "+a.m42.toFixed(2)+" "+a.m43.toFixed(2)+" "+a.m44.toFixed(2)+"\n"
};