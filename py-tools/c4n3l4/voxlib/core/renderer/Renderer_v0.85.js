function vxlRenderer(a){this.renderRate=vxl.def.renderer.rate.NORMAL;this.mode=vxl.def.renderer.mode.TIMER;this.timerID=0;this.view=a;this.gl=this.getWebGLContext();this.prg=new vxlProgram(this.gl);this.setDefaultProgram();this.transforms=new vxlTransforms(a)}vxlRenderer.prototype.getWebGLContext=function(){var d=null;var b=this.view.canvas;this.width=b.width;this.height=b.height;var g=["webgl","experimental-webgl","webkit-3d","moz-webgl"];for(var c=0;c<g.length;++c){try{d=b.getContext(g[c])}catch(f){}if(d){break
}}if(d==null){alert("Could not intiailise WebGL");throw ("Could not initialise WebGL");return}else{var a=d;a.enable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.depthFunc(a.LEQUAL)}return d};vxlRenderer.prototype.setDefaultProgram=function(){this.setProgram(vxl.def.glsl.diffusive.NAME,vxl.def.glsl.diffusive)};vxlRenderer.prototype.setProgram=function(c,b){var a=this.prg;if(!a.isRegistered(c)){a.register(c,b)}if(!a.isLoaded(c)){a.loadProgram(c)}a.useProgram(c);a.loadDefaults()
};vxlRenderer.prototype.clear=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.viewport(0,0,this.view.canvas.width,this.view.canvas.height);this.transforms.calculatePerspective()};vxlRenderer.prototype.start=function(){if(this.mode==vxl.def.renderer.mode.TIMER){this.timerID=setInterval((function(a){return function(){a.render()}})(this),this.renderRate)}else{if(this.mode==vxl.def.renderer.mode.ANIMFRAME){message("Renderer for animation invoked")}}};vxlRenderer.prototype.stop=function(){if(this.mode==vxl.def.renderer.mode.TIMER){clearInterval(this.timerID)
}else{if(this.mode==vxl.def.renderer.mode.ANIMFRAME){}}};vxlRenderer.prototype.setRenderRate=function(a){this.renderRate=a;this.stop();if(a==null||a<=0){return}else{this.mode=vxl.def.renderer.mode.TIMER;vxl.go.console("Renderer: view["+this.view.name+"] mode = TIMER, render rate = "+a,true)}this.start()};vxlRenderer.prototype.clearColor=function(a){this.gl.clearColor(a[0],a[1],a[2],1)};vxlRenderer.prototype.clearDepth=function(a){this.gl.clearDepth(a)};vxlRenderer.prototype._setMatrices=function(){this.transforms.update();
var a=this.prg;a.setUniform("uMVMatrix",this.transforms.mvMatrix);a.setUniform("uPMatrix",this.transforms.pMatrix);a.setUniform("uNMatrix",this.transforms.nMatrix)};vxlRenderer.prototype.render=function(){var a=this.view.scene;this.view.prepareForRendering();this._setMatrices();a.render(this)};