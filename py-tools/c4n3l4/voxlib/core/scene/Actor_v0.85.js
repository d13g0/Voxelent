function vxlActor(a){if(a){this.model=a;this.name=a.name;this.diffuse=a.diffuse;if(this.diffuse!=null&&this.diffuse.length==3){this.diffuse.push(1)}}this.buffer={vertex:null,normal:null,color:null,index:null};this.renderers=[];this.buffers=[];this.matrix=new vxlMatrix4x4();this.allocated=false;this.visible=true;this.mode=vxl.def.actor.mode.SOLID;this.opacity=1;this.colors=a?(a.colors!=null?a.colors:null):null}vxlActor.prototype.allocate=function(c){if(this.renderers.indexOf(c)!=-1){return}vxl.go.console("Actor: Allocating actor "+this.model.name+" for view "+c.view.name);
var d=c.gl;var b=this.model;var a={};a.vertex=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a.vertex);d.bufferData(d.ARRAY_BUFFER,new Float32Array(b.vertices.slice(0)),d.STATIC_DRAW);if(b.normals){a.normal=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a.normal);d.bufferData(d.ARRAY_BUFFER,new Float32Array(b.normals.slice(0)),d.STATIC_DRAW)}if(b.scalars||b.colors){a.color=d.createBuffer()}d.bindBuffer(d.ARRAY_BUFFER,null);if(b.indices){a.index=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a.index);
d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(b.indices.slice(0)),d.STATIC_DRAW)}d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null);this.renderers.push(c);this.buffers.push(a)};vxlActor.prototype.deallocate=function(){var a=this.buffer;this.buffer.vertex=null;this.buffer.normal=null;this.buffer.color=null;this.buffer.index=null;throw ("exception")};vxlActor.prototype.render=function(f){if(!this.visible){return}var a=this.renderers.indexOf(f);var c=this.model;var b=this.buffers[a];var g=f.gl;var e=f.prg;
e.setUniform("uOpacity",this.opacity);e.setUniform("uObjectColor",this.diffuse);e.setUniform("uUseVertexColors",false);e.disableVertexAttribArray("aVertexColor");e.disableVertexAttribArray("aVertexNormal");e.enableVertexAttribArray("aVertexPosition");try{g.bindBuffer(g.ARRAY_BUFFER,b.vertex);g.bufferData(g.ARRAY_BUFFER,new Float32Array(c.vertices.slice(0)),g.STATIC_DRAW);e.setVertexAttribPointer("aVertexPosition",3,g.FLOAT,false,0,0)}catch(d){alert("There was a problem while rendering the actor ["+this.name+"]. The problem happened while handling the vertex buffer. Error ="+d.description);
throw ("There was a problem while rendering the actor ["+this.name+"]. The problem happened while handling the vertex buffer. Error ="+d.description)}if(this.colors){try{e.setUniform("uUseVertexColors",true);g.bindBuffer(g.ARRAY_BUFFER,b.color);g.bufferData(g.ARRAY_BUFFER,new Float32Array(this.colors.slice(0)),g.STATIC_DRAW);e.enableVertexAttribArray("aVertexColor");e.setVertexAttribPointer("aVertexColor",4,g.FLOAT,false,0,0)}catch(d){alert("There was a problem while rendering the actor ["+this.name+"]. The problem happened while handling the color buffer. Error ="+d.description);
throw ("There was a problem while rendering the actor ["+this.name+"]. The problem happened while handling the color buffer. Error ="+d.description)}}if(c.normals){try{g.bindBuffer(g.ARRAY_BUFFER,b.normal);g.bufferData(g.ARRAY_BUFFER,new Float32Array(c.normals.slice(0)),g.STATIC_DRAW);e.enableVertexAttribArray("aVertexNormal");e.setVertexAttribPointer("aVertexNormal",3,g.FLOAT,false,0,0)}catch(d){alert("There was a problem while rendering the actor ["+this.name+"]. The problem happened while handling the normal buffer. Error ="+d.description);
throw ("There was a problem while rendering the actor ["+this.name+"]. The problem happened while handling the normal buffer. Error ="+d.description)}}try{if(this.mode==vxl.def.actor.mode.SOLID){e.setUniform("uUseShading",true);e.enableVertexAttribArray("aVertexNormal");g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,b.index);g.drawElements(g.TRIANGLES,c.indices.length,g.UNSIGNED_SHORT,0)}else{if(this.mode==vxl.def.actor.mode.WIREFRAME){e.setUniform("uUseShading",false);e.disableVertexAttribArray("aVertexNormal");
g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,b.index);g.bufferData(g.ELEMENT_ARRAY_BUFFER,new Uint16Array(c.indices.slice(0)),g.STATIC_DRAW);g.drawElements(g.LINES,c.indices.length,g.UNSIGNED_SHORT,0)}else{if(this.mode==vxl.def.actor.mode.POINTS){e.setUniform("uUseShading",true);e.enableVertexAttribArray("aVertexNormal");g.drawArrays(g.POINTS,0,this.model.vertices.length/3)}else{alert("There was a problem while rendering the actor ["+this.name+"]. The visualization mode: "+this.mode+" is not valid.");throw ("There was a problem while rendering the actor ["+this.name+"]. The visualization mode: "+this.mode+" is not valid.")
}}}g.bindBuffer(g.ARRAY_BUFFER,null);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null)}catch(d){alert("Error rendering actor ["+this.name+"]. Error ="+d.description);throw ("Error rendering actor ["+this.name+"]. Error ="+d.description)}};vxlActor.prototype.setColor=function(a){this.color=a.slice(0);vxl.go.console("Actor "+this.name+": color changed to : ("+this.color[0]+","+this.color[1]+","+this.color[2]+")")};vxlActor.prototype.setLookupTable=function(d,c,a){if(this.model.scalars){var b=vxl.go.lookupTableManager.get(d);
this.colors=b.getColors(this.model.scalars,c,a)}};vxlActor.prototype.setMode=function(a){this.mode=a};vxlActor.prototype.setOpacity=function(a){if(a>=0&&a<=1){this.opacity=a}else{throw"The opacity value is not valid"}};vxlActor.prototype.flipNormals=function(){this.model.getNormals(true)};vxlActor.prototype.setVisible=function(a){this.visible=a};vxlActor.prototype.isVisible=function(){return this.visible};