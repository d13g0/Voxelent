function vxlScene(){this.views=[];this.actors=[];this.loadingMode=vxl.def.asset.loadingMode.LIVE;this.normalsFlipped=false;this.lutID=null;this.timerID=null;this.dispatchRate=500;this.scalarMIN=Number.MAX_VALUE;this.scalarMAX=Number.MIN_VALUE;this.bb=[];this.centre=[];this.axisActor=new vxlAxis();this.boundingBoxActor=new vxlBoundingBox();this.floorActor=new vxlFloor();this.actors.push(this.axisActor);this.actors.push(this.boundingBoxActor);this.actors.push(this.floorActor);this.frameAnimation=null;
if(vxl.c.scene==null){vxl.c.scene=this}vxl.go.notifier.addTarget(vxl.events.MODELS_LOADED,this);vxl.go.notifier.addTarget(vxl.events.DEFAULT_LUT_LOADED,this);vxl.go.notifier.addSource(vxl.events.SCENE_UPDATED,this)}vxlScene.prototype.handleEvent=function(a,b){if(a==vxl.events.MODELS_LOADED){this.updateScalarRange();if(this.lutID!=null){this.setLookupTable(this.lutID)}}if(a==vxl.events.DEFAULT_LUT_LOADED){this.lutID="default";this.setLookupTable(this.lutID)}};vxlScene.prototype.setLoadingMode=function(a){if(a==undefined||a==null||(a!=vxl.def.asset.loadingMode.LIVE&&a!=vxl.def.asset.loadingMode.LATER&&a!=vxl.def.asset.loadingMode.DETACHED)){throw ("the mode "+a+"is not a valid loading mode")
}this.loadingMode=a};vxlScene.prototype.updateMetrics=function(a){vxl.go.console("Scene: updating metrics with ("+a[0]+","+a[1]+","+a[2]+") - ("+a[3]+","+a[4]+","+a[5]+")");var c=this.bb;var d=this.centre;c[0]=Math.min(c[0],a[0]);c[1]=Math.min(c[1],a[1]);c[2]=Math.min(c[2],a[2]);c[3]=Math.max(c[3],a[3]);c[4]=Math.max(c[4],a[4]);c[5]=Math.max(c[5],a[5]);d[0]=(c[3]+c[0])/2;d[1]=(c[4]+c[1])/2;d[2]=(c[5]+c[2])/2;d[0]=Math.round(d[0]*1000)/1000;d[1]=Math.round(d[1]*1000)/1000;d[2]=Math.round(d[2]*1000)/1000;
this.axisActor.setCentre(this.centre);this.boundingBoxActor.setBoundingBox(this.bb)};vxlScene.prototype.computeMetrics=function(){this.bb=[0,0,0,0,0,0];this.centre=[0,0,0];for(var a=0;a<this.actors.length;a++){if(this.actors[a].witness){continue}this.updateMetrics(this.actors[a].model.outline)}};vxlScene.prototype.createActor=function(a){var b=new vxlActor(a);if(this.normalsFlipped){b.flipNormals(true)}if(this.lutID!=null){b.setLookupTable(this.lutID,this.scalarMIN,this.scalarMAX)}this.actors.push(b);
this.updateMetrics(b.model.outline);vxl.go.console("Scene: Actor for model "+a.name+" created");vxl.go.notifier.fire(vxl.events.SCENE_UPDATED);return b};vxlScene.prototype.createActors=function(b){vxl.go.console("Scene: Creating all the actors now");for(var a=0;a<b.length;a++){this.createActor(b[a])}};vxlScene.prototype.addActor=function(a){this.actors.push(a);this.updateMetrics(a.model.outline);vxl.go.notifier.fire(vxl.events.UPDATED_SCENE)};vxlScene.prototype.removeActor=function(b){var a=this.actors.indexOf(b);
this.actors.splice(a,1);this.computeMetrics()};vxlScene.prototype.updateScalarRange=function(){for(var a=0;a<this.actors.length;a++){var b=this.actors[a];if(b.model.scalars&&b.model.scalars.max()>this.scalarMAX){this.scalarMAX=b.model.scalars.max()}if(b.model.scalars&&b.model.scalars.min()<this.scalarMIN){this.scalarMIN=b.model.scalars.min()}}};vxlScene.prototype.setLookupTable=function(c){this.lutID=c;for(var a=0;a<this.actors.length;a++){var b=this.actors[a];if(b.setLookupTable){b.setLookupTable(c,this.scalarMIN,this.scalarMAX)
}}};vxlScene.prototype.reset=function(){for(var a=0;a<this.actors.length;a++){this.actors[a]=null}this.actors=[];vxl.c.actor=null;this.actors.push(this.axisActor);this.actors.push(this.boundingBoxActor);this.computeMetrics()};vxlScene.prototype.getActorByName=function(a){for(var b=0;b<this.actors.length;b++){if(this.actors[b].name==a){return this.actors[b]}}return null};vxlScene.prototype.setOpacity=function(d,a){if(a==null){for(var b=0;b<this.actors.length;b++){this.actors[b].setOpacity(d)}}else{var c=this.getActorByName(a);
c.setOpacity(d)}};vxlScene.prototype.flipNormals=function(a){this.normalsFlipped=a;for(var b=0;b<this.actors.length;b++){this.actors[b].flipNormals(a)}};vxlScene.prototype.setColor=function(e,a){if(a==null){vxl.go.console("Scene: set color for all actors");for(var b=0;b<this.actors.length;b++){this.actors[b].setColor(e)}}else{vxl.go.console("Scene: set color for active actor:"+a);var d=this.getActorByName(a);d.setColor(e)}};vxlScene.prototype.setVisualizationMode=function(b){if(b==null||b==undefined){return
}for(var a=0;a<this.actors.length;a++){this.actors[a].setVisualizationMode(b)}};vxlScene.prototype.render=function(g){for(var c=0,e=this.views.length;c<e;c+=1){var f=this.views[c].renderer;if(this.frameAnimation==null){for(var b=0,d=this.actors.length;b<d;b+=1){this.actors[b].allocate(f);this.actors[b].render(f)}}else{this.boundingBoxActor.allocate(f);this.boundingBoxActor.render(f);this.frameAnimation.render(f)}}};vxlScene.prototype.setFrameAnimation=function(a){if(a instanceof vxlFrameAnimation){this.frameAnimation=a;
this.frameAnimation.scene=this;vxl.go.console("Scene: animation added")}};vxlScene.prototype.clearFrameAnimation=function(){if(this.frameAnimation){this.frameAnimation.scene=null;this.frameAnimation=null}};