function vxlCamera(b,a){this.view=b;this.matrix=new vxlMatrix4x4();this.up=vxl.vec3.create([0,1,0]);this.right=vxl.vec3.create([1,0,0]);this.normal=vxl.vec3.create([0,0,0]);this.position=vxl.vec3.create([0,0,1]);this.focus=vxl.vec3.create([0,0,0]);this.azimuth=0;this.elevation=0;this.steps=0;this.home=vxl.vec3.create([0,0,0]);this.id=0;if(a!=undefined&&a!=null){this.type=a}else{this.type=vxl.def.camera.type.ORBITING}this.distance=0;this.debug=false}vxlCamera.prototype.setType=function(a){if(a!=vx.def.camera.type.ORBITING&&a!=vxl.def.camera.type.TRACKING){alert("Wrong Camera Type!. Setting Orbitting type by default");
this.type=vxl.def.camera.type.ORBITING}else{this.type=a}};vxlCamera.prototype.init=function(){var a=this;this.goHome([0,0,1]);this.setFocus([0,0,0]);vxl.mat4.identity(this.matrix)};vxlCamera.prototype.goHome=function(a){if(a!=null){this.home=vxl.vec3.create(a)}this.setPosition(a);this.setAzimuth(0);this.setElevation(0);this.steps=0};vxlCamera.prototype.computeDistance=function(){vxl.go.console("compute distance called")};vxlCamera.prototype.setDistance=function(a){vxl.go.console("set distance called")
};vxlCamera.prototype.computeViewTransform=function(){vxl.go.console("compute view transform called")};vxlCamera.prototype.setPosition=function(a){vxl.vec3.set(vxl.vec3.create(a),this.position);this.update();this.debugMessage("vxlCamera: Updated position: "+this.position.toString(1))};vxlCamera.prototype.setFocus=function(a){vxl.vec3.set(vxl.vec3.create(a),this.focus);this.update();this.debugMessage("vxlCamera: Updated focus: "+this.focus.toString(1))};vxlCamera.prototype.pan=function(b,a){vxl.go.console(" pan called")
};vxlCamera.prototype.dolly=function(a){vxl.go.console(" dolly called")};vxlCamera.prototype.setAzimuth=function(a){this.changeAzimuth(a-this.azimuth)};vxlCamera.prototype.changeAzimuth=function(a){var b=this;b.azimuth+=a;if(b.azimuth>360||b.azimuth<-360){b.azimuth=b.azimuth%360}b.update()};vxlCamera.prototype.setElevation=function(a){this.changeElevation(a-this.elevation)};vxlCamera.prototype.changeElevation=function(a){var b=this;b.elevation+=a;if(b.elevation>360||b.elevation<-360){b.elevation=b.elevation%360
}b.update()};vxlCamera.prototype.computeAxis=function(){var a=this.matrix;this.right=vxl.mat4.multVec3(a,[1,0,0]);this.up=vxl.mat4.multVec3(a,[0,1,0]);this.normal=vxl.mat4.multVec3(a,[0,0,1])};vxlCamera.prototype.update=function(){vxl.mat4.identity(this.matrix);this.computeAxis();if(this.type==vxl.def.camera.type.TRACKING){vxl.mat4.translate(this.matrix,this.position);vxl.mat4.rotateY(this.matrix,this.azimuth*Math.PI/180);vxl.mat4.rotateX(this.matrix,this.elevation*Math.PI/180)}else{var a=new vxlMatrix4x4();
vxl.mat4.translate(this.matrix,this.focus);vxl.mat4.rotateY(this.matrix,this.azimuth*Math.PI/180);vxl.mat4.rotateX(this.matrix,this.elevation*Math.PI/180);vxl.mat4.translate(this.matrix,vxl.vec3.negate(this.focus));vxl.mat4.translate(this.matrix,this.position)}this.computeAxis();if(this.type==vxl.def.camera.type.TRACKING){vxl.mat4.multVec4(this.matrix,new vxlVector4(0,0,0,1),this.position)}this.debugMessage("------------- update -------------");this.debugMessage(" right: "+this.right.toString(2)+", up: "+this.up.toString(2)+", normal: "+this.normal.toString(2));
this.debugMessage("   pos: "+this.position.toString(2));this.debugMessage("   azimuth: "+this.azimuth+", elevation: "+this.elevation)};vxlCamera.prototype.getViewTransform=function(){var a=new vxlMatrix4x4();vxl.mat4.set(this.matrix,a);vxl.mat4.inverse(a);return a};vxlCamera.prototype.refresh=function(){this.view.refresh()};vxlCamera.prototype.shot=function(c){var b=Math.max(c[3]-c[0],c[4]-c[1]);var a=this.view.scene.centre;if(b!=0){var d=1.5*b/(Math.tan(this.view.fovy*Math.PI/180));this.setPosition([a[0],a[1],a[2]+d])
}this.setFocus(a)};vxlCamera.prototype.longShot=function(){this.shot(this.view.scene.bb)};vxlCamera.prototype.save=function(){var a=this;a.state.save(this);this.debugMessage("Viewpoint saved")};vxlCamera.prototype.retrieve=function(){var a=this;a.state.retrieve();this.debugMessage("Viewpoint restored")};vxlCamera.prototype.reset=function(){var a=this;a.state.reset();vxl.go.console("Camera: reset")};vxlCamera.prototype.above=function(){var a=this;this.elevation=90;this.azimuth=0;this.xTr=0;this.yTr=0;
vxl.vec3.set([0,0,-1],a.up);vxl.vec3.set([1,0,0],a.right);a.setPosition(0,a.distance,0);vxl.go.console("Camera: above")};vxlCamera.prototype.below=function(){var a=this;this.elevation=-90;this.azimuth=0;this.xTr=0;this.yTr=0;vxl.vec3.set([0,0,1],a.up);vxl.vec3.set([1,0,0],a.right);a.setPosition(0,-a.distance,0);vxl.go.console("Camera: below")};vxlCamera.prototype.right=function(){var a=this;this.elevation=0;this.azimuth=-90;this.xTr=0;this.yTr=0;vxl.vec3.set([0,1,0],a.up);vxl.vec3.set([0,0,1],a.right);
a.setPosition(-a.distance,0,0);vxl.go.console("Camera: right")};vxlCamera.prototype.left=function(){var a=this;this.elevation=0;this.azimuth=90;this.xTr=0;this.yTr=0;vxl.vec3.set([0,1,0],a.up);vxl.vec3.set([0,0,1],a.right);a.setPosition(a.distance,0,0);vxl.go.console("Camera: left")};vxlCamera.prototype.debugMessage=function(a){if(this.debug){vxl.go.console(a)}};